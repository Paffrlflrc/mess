/*! For license information please see main.eb19ea81545b2a998a34.js.LICENSE.txt */
!function(){"use strict";var e,t,n,r={978:function(e,t,n){var r=n(1104),i=n(959),o=n(4478),s=n(1458),c=n(3697),l=n(1242),a=n(7648),d=n(6386),h=n(7345),u=n(66),f=n(5186),b=n(2831),p=n(4767),g=n(5068),Z=n(8963),m=n(9865),w=n(7582),C=n(5684),R=n(2883),L=n(1988),y=n(3392),v=n(7833),G=n(4063),k=n(5200),A=n(4205),S=n(8501),x=n(4343),M=n(7921),E=n(9373),O=n(5334),P=n(2066),_=n(3899),j=n(2991),V=n(2967),B=n(3817),I=n(6495),z=n(5742),D=async()=>new Promise((e=>{const t=document.createElement("input");t.type="file",t.click(),t.onchange=()=>{const n=t.files[0],r=new FileReader;r.readAsDataURL(n),r.onload=()=>{const t=r.result.toString(),n=window.atob(t.slice(t.indexOf("base64")+7));e(n)}}}));const{Content:T,Sider:F}=d.default;function X(e){return(0,r.BX)(l.E.div,{initial:"close",animate:e.open?"open":"close",variants:{open:{scaleX:1},close:{scaleX:0}},style:{position:"fixed",top:0,left:0,zIndex:2,height:"100%",width:"50vw",minWidth:300,transformOrigin:"left",backgroundColor:"whitesmoke",boxShadow:"0 0 3px 3px rgba(0, 0, 0, 0.3)"},children:[(0,r.tZ)(l.E.div,{children:(0,r.tZ)(M.Z,{onClick:()=>{e.handleClose()},children:(0,r.tZ)(j.Z,{})})}),(0,r.tZ)(k.aV,{onChange:({oldIndex:t,newIndex:n})=>{e.handleChange((0,k.Rp)(Object.keys(e.mols),t,n))},values:Object.keys(e.mols),renderList:({children:e,props:t})=>(0,r.tZ)(E.Z,{sx:{zIndex:3,padding:0},...t,children:e}),renderItem:({value:t,props:n})=>(0,r.BX)(O.ZP,{sx:{zIndex:3,padding:0},...n,children:[(0,r.tZ)(P.Z,{sx:{flexGrow:1,textAlign:"center",fontWeight:600},children:t}),(0,r.tZ)(S.Z,{onChange:n=>{n?e.mols[t].sfh():e.mols[t].h()},defaultChecked:!0})]})})]})}const H=i.forwardRef(((e,t)=>{const[n,o]=i.useState(!1),s=i.useRef(null),c=(0,v.o)(),a=(0,G.E)();return i.useEffect((()=>{e.animationControl(a)}),[a]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(X,{handleClose:()=>o(!1),handleChange:t=>{const n={};t.forEach((t=>{n[t]=e.mols[t]})),e.handleSort(n)},open:n,mols:e.mols}),(0,r.tZ)(A.ZP,{refreshMode:"throttle",refreshRate:100,targetRef:s,children:({height:i,width:h})=>(0,r.tZ)(l.E.div,{animate:a,ref:s,style:{height:window.innerHeight,width:window.innerWidth,maxHeight:window.innerHeight,maxWidth:window.innerWidth,position:"absolute",top:0,left:0,zIndex:-1,resize:"both",overflow:"hidden",boxShadow:"0 0 0.3rem 0.1rem rgba(0, 0, 0, 0.314)"},drag:!0,dragConstraints:{left:0,top:0,bottom:window.innerHeight-i,right:window.innerWidth-h},dragListener:!1,dragControls:c,children:(0,r.tZ)(l.E.div,{style:{height:"100%",width:"100%",backgroundColor:"whitesmoke"},children:(0,r.BX)(d.default,{style:{height:i,width:h},children:[(0,r.BX)(l.E.div,{style:{width:"100%",height:"min-content",zIndex:1,backgroundColor:"transparent"},children:[(0,r.tZ)(l.E.span,{onPointerDown:e=>{c.start(e)},children:(0,r.tZ)(M.Z,{children:(0,r.tZ)(V.Z,{})})}),(0,r.tZ)(M.Z,{onClick:()=>{e.handleClose()},children:(0,r.tZ)(j.Z,{})})]}),(0,r.tZ)(T,{children:(0,r.tZ)(l.E.div,{style:{height:i||window.innerHeight,width:(h||window.innerWidth)-40},ref:t})}),(0,r.tZ)(F,{theme:"light",width:"fit-content",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between"},children:(0,r.BX)(x.Z,{direction:"vertical",split:(0,r.tZ)(_.Z,{sx:{background:"black"},orientation:"horizontal",variant:"middle"}),children:[(0,r.tZ)(M.Z,{onClick:async()=>{o(!1);const t=await D();e.renderFromUpload(t)},children:(0,r.tZ)(B.Z,{})}),(0,r.tZ)(M.Z,{onClick:()=>o(!n),children:(0,r.tZ)(I.Z,{})}),(0,r.tZ)(M.Z,{onClick:()=>{Object.values(e.mols).forEach((e=>{e.reset()}))},children:(0,r.tZ)(z.Z,{})})]})})]})})})})]})}));var W=i.memo(H),U=i.forwardRef(((e,t)=>(0,r.tZ)(l.E.textarea,{style:{height:"100%",width:"100%",padding:"2rem",resize:"none",border:"none",outline:"none",backgroundColor:"whitesmoke",color:"black",fontFamily:"monospace",fontSize:"1rem",fontWeight:"600",letterSpacing:"0.2rem"},ref:t,autoFocus:!0,placeholder:"键入序列或通过菜单上传序列的文本文件"})));(0,n(8988).k_)(a.Z,{retryLimit:10});var N=n(5826),Y=n(2475),q=n.n(Y);class K{GLV;CA;RA;CGLMiibC={};CGLMPDBibC={};RdAibRiibC={};lF;lfRGLM;lfL;cF;id;ish;constructor(e,t,n){this.id=n||(new Date).toISOString(),this.bind(t),this.render(e);const r=[],{CA:i,RdAibRiibC:o}=this;i.forEach((e=>{const t=o[e],n=Reflect.ownKeys(t).map(Number);for(let e=0;e<n.length;e+=1){const i=t[n[e]];r.push(i)}})),this.RA=r}getPngUrl(){return this.GLV.pngURI()}bind(e){this.GLV=N.createViewer(e,{id:`${this.id}`,backgroundAlpha:0})}static gafRn(e){switch(e){case"ALA":case"Ala":return"A";case"ARG":return"R";case"ASN":return"N";case"ASP":return"D";case"CYS":return"C";case"GLN":return"Q";case"GLU":return"E";case"GLY":return"G";case"HIS":return"H";case"ILE":return"I";case"LEU":return"L";case"LYS":return"K";case"MET":return"M";case"PHE":return"F";case"PRO":return"P";case"SER":return"S";case"THR":return"T";case"TRP":return"W";case"TYR":return"Y";case"VAL":return"V";case"SEC":return"U";case"PYL":return"O";case"HOH":return"水";case"NAG":return"葡";case"PO4":return"磷";default:return e}}static gAAfPDB(e){return N.Parsers.PDB(e,{})[0]}static gCAfcGLMAA(e){let t=[e[0].chain];for(let n=1;n<e.length;n+=1){const r=t[t.length-1];e[n].chain!==r&&t.push(e[n].chain)}var n;return n=t,t=Array.from(new Set(n)),t}static gRibRiibC(e,t){const n={},r=e[0],i={C:r.chain,CGLMi:t[r.chain],Ri:r.resi,Rn:K.gafRn(r.resn),Rpl:r.pdbline};n[r.chain]={},n[r.chain][i.Ri]=i;for(let r=1;r<e.length;r+=1){const i=e[r],{chain:o,pdbline:s,resi:c,resn:l}=i;if(n[o])if(n[o][c]){const e=n[o][c];e.Rpl+="\n",e.Rpl+=s}else n[o][c]={C:o,CGLMi:t[o],Ri:c,Rn:K.gafRn(l),Rpl:s};else n[o]={},n[o][c]={C:o,CGLMi:t[o],Ri:c,Rn:K.gafRn(l),Rpl:s}}return n}static gCGLMPDBibCfCA(e){const t={};for(let n=0;n<e.length;n+=1){const r=e[n],{chain:i,pdbline:o}=r;t[i]?(t[i]+="\n",t[i]+=o):t[i]=o}return t}uCGLM(e,t){const n=K.gCGLMPDBibCfCA(t);for(let t=0,r=e.length;t<r;t+=1){const r=e[t],i=this.GLV.addModel(n[r],"pdb");this.CGLMiibC[r]=i.getID(),i.setStyle({},{cartoon:{color:q()({luminosity:"light"})}})}}uRGLM_bRdAibRiibC(e,t){for(let n=0,r=t.length;n<r;n+=1){const r=t[n],i=e[r],o=Reflect.ownKeys(i).map(Number);for(let e=0,t=o.length;e<t;e+=1){const t=o[e],n=i[t];this.RdAibRiibC[r]||(this.RdAibRiibC[r]={}),this.RdAibRiibC[r][t]=n}}}sc(){this.CA.forEach((e=>{const t=this.CGLMiibC[e];this.GLV.getModel(t).setClickable({},!0,(e=>{const{chain:t,resi:n}=e,r=this.RdAibRiibC[t][n];this.focus(r),this.cF=r}))}))}render(e){const t=K.gAAfPDB(e);this.CA=K.gCAfcGLMAA(t),this.uCGLM(this.CA,t);const n=K.gRibRiibC(t,this.CGLMiibC);this.uRGLM_bRdAibRiibC(n,this.CA),this.sc(),this.GLV.render(),this.GLV.zoomTo(),this.GLV.zoom(.618)}h(){this.ish=!0,this.CA.forEach((e=>{const t=this.CGLMiibC[e];this.GLV.getModel(t).hide(),this.lfRGLM&&this.lfRGLM.hide()})),this.lfL&&this.GLV.setLabelStyle(this.lfL,{showBackground:!1,fontOpacity:0}),this.GLV.render()}sfh(){this.ish=!1,this.CA.forEach((e=>{const t=this.CGLMiibC[e];this.GLV.getModel(t).show(),this.lfRGLM&&this.lfRGLM.show()})),this.lfL&&this.GLV.setLabelStyle(this.lfL,{showBackground:!0,fontOpacity:1}),this.GLV.render()}focus(e){const{Rpl:t,Rn:n}=e;let r;(()=>{this.lF&&this.GLV.removeModel(this.lfRGLM),this.lF=e,r=this.GLV.addModel(t,"pdb"),this.lfRGLM=r,r.setStyle({},{sphere:{opacity:.816},stick:{}})})(),(()=>{this.GLV.removeAllLabels(),this.lfL=this.GLV.addLabel(n,{fontSize:13.4},{model:r.getID()})})(),(()=>{this.GLV.render()})();const{C:i,Ri:o}=e;this.GLV.zoomTo({resi:o,chain:i},168)}reset(){this.GLV.zoomTo()}}var $=K;const{Content:J,Sider:Q,Header:ee}=d.default;function te(e){return(0,r.tZ)(l.E.b,{style:{letterSpacing:"1rem"},children:e.label})}const ne=[{key:"input",label:(0,r.tZ)(te,{label:"输入"}),title:"输入",icon:(0,r.tZ)(Z.Z,{}),children:[{key:"upload",label:(0,r.tZ)(te,{label:"上传"}),title:"上传序列文本文件",icon:(0,r.tZ)(m.Z,{})}]},{key:"output",label:(0,r.tZ)(te,{label:"输出"}),title:"输出",icon:(0,r.tZ)(w.Z,{}),children:[{key:"structure",label:(0,r.tZ)(te,{label:"结构"}),title:"结构",icon:(0,r.tZ)(C.Z,{})},{key:"export",label:(0,r.tZ)(te,{label:"导出"}),title:"导出预测结果为文件",icon:(0,r.tZ)(R.Z,{})}]}];var re=function(){const[e,t]=i.useState(!1),[n,o]=i.useState(null),[s,l]=i.useState({}),[Z,m]=i.useState(""),w=i.useRef(null),C=i.useRef(null),R=(0,c.s0)(),v=i.useCallback((e=>{const t=(new Date).getTime().toString(),n=new $(e,C.current,t);return l((e=>(e[t]=n,e))),t}),[]);return(0,r.BX)(d.default,{children:[(0,r.tZ)(Q,{trigger:null,collapsed:e,children:(0,r.tZ)(h.Z,{onClick:async({key:e})=>{switch(e){case"upload":w.current.value=await D();break;case"structure":n.start({zIndex:1});break;case"export":(e=>{const t=document.createElement("a");t.download=`${(new Date).getTime().toString()}.pdb`;const n=new Blob(e.split(""),{type:"text/plain"}),r=window.URL.createObjectURL(n);t.href=r,t.click()})(Z)}},selectable:!1,mode:"inline",theme:"dark",items:ne})}),(0,r.BX)(d.default,{style:{height:"100vh"},children:[(0,r.tZ)(ee,{style:{padding:0,backgroundColor:"white"},children:(0,r.BX)(u.Z,{justify:"space-between",children:[(0,r.tZ)(f.Z,{children:(0,r.tZ)(p.Z,{onClick:()=>{t(!e)},sx:{height:"100%",fontSize:"1rem"},children:(0,r.tZ)(L.Z,{})})}),(0,r.tZ)(f.Z,{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.BX)(g.Z,{sx:{padding:"0 1rem"},children:[(0,r.BX)(p.Z,{onClick:()=>{R("/")},sx:{fontFamily:"monospace",fontSize:"1rem",fontWeight:"600",letterSpacing:"0.2rem"},variant:"outlined",children:[(0,r.tZ)(y.Z,{}),"返回"]}),(0,r.tZ)(p.Z,{onClick:async()=>{const e=await a.Z.get(`/sequence?=amino_acid_seq=${w.current.value}`).then((e=>e.data)).catch((e=>{throw console.error(e),b.ZP.error("请求序列查询失败"),new Error("请求序列查询失败")}));e.success?"序列存在"===e.msg?b.ZP.info("序列存在"):"序列不存在"===e.msg&&(b.ZP.info("序列未录入"),b.ZP.info("正在录入新序列"),a.Z.post("/sequence",{data:{amino_acid_seq:w.current.value}}).then((e=>{e.data.success&&b.ZP.success("新序列上传成功")})).catch((e=>{throw console.error(e),b.ZP.error("序列上传失败"),new Error("序列上传失败")}))):b.ZP.info("查询失败");const t=await(async e=>{const{data:t}=await a.Z.post("/prediction?sequence",{data:{amino_acid_seq:e}}).catch((e=>{throw console.error(e),new Error("启动请求发送失败")}));return new Promise(((e,n)=>{if(t||t.success){const{emit:r,on:i,off:o,remove:s}=a.Z.poll({url:"/prediction/status",params:{job_id:t.job_id}});r(),i("response",(r=>{"finish"===r.data.status&&(o(),s(),a.Z.get("/prediction/result",{params:{job_id:t.job_id,type:"pdb"}}).then((({data:t})=>{(t||t.success)&&e(t.result),n(new Error("获取预测结果失败"))})).catch((e=>{console.error(e),n(new Error("获取预测结果请求发送失败"))})))})),i("error",(e=>{console.error(e.toJSON()),n(new Error("获取预测进度失败"))}))}else n(new Error("创建任务失败"))}))})(w.current.value);m(t),v(t),n.start({zIndex:1})},sx:{fontFamily:"monospace",fontSize:"1rem",fontWeight:"600",letterSpacing:"0.2rem"},variant:"contained",children:"提交"})]})})]})}),(0,r.BX)(J,{children:[(0,r.tZ)(U,{ref:w}),(0,r.tZ)(W,{mols:s,ref:C,handleClose:()=>{n.set({zIndex:-1})},handleSort:e=>{l(e);const t=C.current,n={};Array.from(t.children).forEach((e=>{n[e.id]=e})),Object.keys(e).forEach((e=>{t.append(n[e])}))},animationControl:e=>o(e),renderFromUpload:e=>v(e)})]})]})]})};const ie=document.getElementById("reactRoot");(0,o.s)(ie).render((0,r.tZ)(i.StrictMode,{children:(0,r.tZ)((function(){return(0,r.tZ)(s.UT,{children:(0,r.tZ)(c.Z5,{children:(0,r.tZ)(c.AW,{path:"/",element:(0,r.tZ)(re,{})})})})}),{})}))}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return r[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=r,e=[],o.O=function(t,n,r,i){if(!n){var s=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],i=e[d][2];for(var c=!0,l=0;l<n.length;l++)(!1&i||s>=i)&&Object.keys(o.O).every((function(e){return o.O[e](n[l])}))?n.splice(l--,1):(c=!1,i<s&&(s=i));if(c){e.splice(d--,1);var a=r();void 0!==a&&(t=a)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,r,i]},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},n=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},o.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var i=Object.create(null);o.r(i);var s={};t=t||[null,n({}),n([]),n(n)];for(var c=2&r&&e;"object"==typeof c&&!~t.indexOf(c);c=n(c))Object.getOwnPropertyNames(c).forEach((function(t){s[t]=function(){return e[t]}}));return s.default=function(){return e},o.d(i,s),i},o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){var e={179:0,360:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,i,s=n[0],c=n[1],l=n[2],a=0;if(s.some((function(t){return 0!==e[t]}))){for(r in c)o.o(c,r)&&(o.m[r]=c[r]);if(l)var d=l(o)}for(t&&t(n);a<s.length;a++)i=s[a],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(d)},n=self.webpackChunk_paffrlflrc_demo=self.webpackChunk_paffrlflrc_demo||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var s=o.O(void 0,[360,835],(function(){return o(978)}));s=o.O(s)}();